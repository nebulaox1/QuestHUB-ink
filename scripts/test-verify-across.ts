
import { createPublicClient, http, decodeEventLog, toEventSelector } from 'viem';
import { base } from 'viem/chains';

const eventAbi = {
    anonymous: false,
    inputs: [
        { indexed: true, internalType: 'address', name: 'inputToken', type: 'address' },
        { indexed: true, internalType: 'address', name: 'outputToken', type: 'address' },
        { indexed: false, internalType: 'uint256', name: 'inputAmount', type: 'uint256' },
        { indexed: false, internalType: 'uint256', name: 'outputAmount', type: 'uint256' },
        { indexed: false, internalType: 'uint256', name: 'destinationChainId', type: 'uint256' },
        { indexed: false, internalType: 'uint32', name: 'depositId', type: 'uint32' },
        { indexed: false, internalType: 'uint32', name: 'quoteTimestamp', type: 'uint32' },
        { indexed: false, internalType: 'uint32', name: 'fillDeadline', type: 'uint32' },
        { indexed: false, internalType: 'uint32', name: 'exclusivityDeadline', type: 'uint32' },
        { indexed: true, internalType: 'address', name: 'depositor', type: 'address' },
        { indexed: false, internalType: 'address', name: 'recipient', type: 'address' },
        { indexed: false, internalType: 'address', name: 'exclusiveRelayer', type: 'address' },
        { indexed: false, internalType: 'bytes', name: 'message', type: 'bytes' }
    ],
    name: 'V3FundsDeposited',
    type: 'event'
};

const RAW_DATA = "0x00000000000000000000000042000000000000000000000000000000000000060000000000000000000000004200000000000000000000000000000000000006000000000000000000000000000000000000000000000000000009184e72a000000000000000000000000000000000000000000000000000000008ed5009ac6f000000000000000000000000000000000000000000000000000000006936068f00000000000000000000000000000000000000000000000000000000693622af000000000000000000000000000000000000000000000000000000006936071a0000000000000000000000000f7ae28de1c8532170ad4ee566b5801485c13a0e000000000000000000000000cad97616f91872c02ba3553db315db4015cbe8500000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000048000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000003200000000000000000000000000f7ae28de1c8532170ad4ee566b5801485c13a0e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000144c41e829500000000000000000000000042000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000242e1a7d4d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000042000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000f7ae28de1c8532170ad4ee566b5801485c13a0e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044ef8738d30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6335f7604f1e97fc47027feb0d9d718ce3ce9fa000000000000000000000000000000000000000000000000000000000000000000000000000000000f7ae28de1c8532170ad4ee566b5801485c13a0e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044ef8738d30000000000000000000000004200000000000000000000000000000000000006000000000000000000000000d6335f7604f1e97fc47027feb0d9d718ce3ce9fa00000000000000000000000000000000000000000000000000000000";
const RAW_TOPICS = [
    "0x32ed1a409ef04c7b0227189c3a103dc5ac10e775a15b785dcc510201f7c25ad3",
    "0x000000000000000000000000000000000000000000000000000000000000def1",
    "0x00000000000000000000000000000000000000000000000000000000004e8dec",
    "0x000000000000000000000000d6335f7604f1e97fc47027feb0d9d718ce3ce9fa"
];

async function debug() {
    console.log('Calculating Selector...');
    const selector = toEventSelector(eventAbi);
    console.log('My ABI Selector:   ', selector);
    console.log('Actual Log Topic 0:', RAW_TOPICS[0]);

    if (selector !== RAW_TOPICS[0]) {
        console.error('MISMATCH! The ABI signature is wrong.');
        return;
    } else {
        console.log('Selector Matches! âœ…');
    }

    console.log('Attempting verify decoding...');
    try {
        const decoded = decodeEventLog({
            abi: [eventAbi],
            data: RAW_DATA as `0x${string}`,
            topics: RAW_TOPICS as [`0x${string}`, ...`0x${string}`[]]
        });
        console.log('Decoded successfully:', decoded);
    } catch (e) {
        console.error('Decoding failed:', e);
    }
}

debug();
